---
templateKey: blog-post
title: RaspberryPiでv4l2loopbackを動かし仮想メディアデバイスを使う
date: 2020-06-20T00:25:30.292Z
description: RaspberryPiで仮想カメラデバイスとして動かしたくてv4l2loopbackを使ってみました。
---
RaspberryPiで仮想カメラデバイスとして動かしたくてv4l2loopbackを使ってみました。

[GitHub - umlaeute/v4l2loopback: v4l2-loopback device](https://github.com/umlaeute/v4l2loopback)

OpenCVなどで加工したWebカメラの映像を仮想デバイスとして認識させてWebRTCなどで配信できます。

## インストール

```
git clone https://github.com/umlaeute/v4l2loopback.git
cd v4l2loopback
make
```

### エラーが出ました

`make`コマンドを実行するとエラーが出ました。

```
Building v4l2-loopback driver...
make -C /lib/modules/`uname -r`/build M=/home/pi/v4l2loopback modules
make[1]: *** /lib/modules/5.4.45-v7l+/build: そのようなファイルやディレクトリはありません.  中止.
make: *** [Makefile:43: v4l2loopback.ko] エラー 2
```

リポジトリを調べてみると同じようなエラーに当たっているissueがありました。

[Can't make v4l2loopback · Issue #162 · umlaeute/v4l2loopback · GitHub](https://github.com/umlaeute/v4l2loopback/issues/162#)

> hi there how do i get the kernal header installed

### kernel headerを入れてみる

カーネルヘッダーが無いのが原因らしいので`raspberrypi-kernel-headers`を入れてます。

[Kernel Headers - Raspberry Pi Documentation](https://www.raspberrypi.org/documentation/linux/kernel/headers.md)

```
sudo apt install raspberrypi-kernel-headers
```

インストールできたはず。

```
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
raspberrypi-kernel-headers はすでに最新バージョン (1.20200601-1) です。
アップグレード: 0 個、新規インストール: 0 個、削除: 0 個、保留: 189 個。
```

もう一度`make`コマンドを実行してみるも、結果は変わらず。。。

#### v4l2loopbackリポジトリにissueを立ててみた

[Can't build v4l2loopback on RaspberryPi · Issue #318 · umlaeute/v4l2loopback · GitHub](https://github.com/umlaeute/v4l2loopback/issues/318)
