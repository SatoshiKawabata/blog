---
templateKey: blog-post
title: Webカメラの映像で顔認識する(node-opencv使用)
date: 2020-06-17T22:51:08.877Z
description: Node.jsとOpenCVを使ってWebカメラの映像で顔認識してみます。
---
Node.jsとOpenCVを使ってWebカメラの映像で顔認識してみます。

Node.jsなのでnode-opencvというnpmを使いました。

[opencv - npm](https://www.npmjs.com/package/opencv)

Node.jsを使ってOpenCVのWebカメラ映像を入力に使うまでの記事はこちらです。

[RaspberryPi上でOpenCVでWebカメラの映像入力を使う(node-opencv使用) | blog.kwst.site](https://blog.kwst.site/202006141606/)

今回はWebカメラの映像を使って顔認識してみます。こちらの記事を大変参考にさせていただきました。

[Node.jsでもOpenCVしてみる - uepon日々の備忘録](https://uepon.hatenadiary.com/entry/2017/04/11/212009)

## 顔認識プログラム

Webカメラ映像をウィンドウに表示しながら顔に赤い矩形を表示します。`detectObject`メソッドで顔を取得できます。`detectObject`メソッドで顔を取得するのに時間がかかるのか、かなりカクカクした映像になってしまいます。

```
const cv = require('opencv');

try {
    const RED = [0, 0, 255];
    const THICKNESS = 2;
    const camera = new cv.VideoCapture(0);
    const window = new cv.NamedWindow('Video', 0)
    const TIME_OUT_SEC = 1;

    const loop = () => {
        camera.read((err, im) => {
            if (err) throw err;
            console.log(im.size())

            if (im.size()[0] > 0 && im.size()[1] > 0) {
                im.detectObject("./node_modules/opencv/data/haarcascade_frontalface_alt.xml", {}, (err, faces) => {
                    for (let i = 0; i < faces.length; i++) {
                        const face = faces[i]
                        im.rectangle([face.x, face.y], [face.width, face.height], RED, THICKNESS);
                    }
                    window.show(im);
                    window.blockingWaitKey(0, 1);
                    setTimeout(loop, TIME_OUT_SEC);
                });
            }
        });
    }

    setTimeout(loop, TIME_OUT_SEC);
} catch (e) {
    console.log("Couldn't start camera:", e)
}
```

### 顔認識には学習済みの分類器を使う

`detectObject`メソッドの引数として渡しているファイルは画像のどの部分を抽出するかを既に学習済みの分類器というものです。今回は[haarcascade_frontalface_alt.xml](https://github.com/peterbraden/node-opencv/blob/master/data/haarcascade_frontalface_alt.xml)を使用しました。これは正面を向いた顔に反応する分類器らしいです。

他にもプリセットで色々用意されています。

[node-opencv/data at master · peterbraden/node-opencv · GitHub](https://github.com/peterbraden/node-opencv/tree/master/data)

