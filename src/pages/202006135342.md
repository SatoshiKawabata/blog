---
templateKey: blog-post
title: RaspberryPiでカメラを使う
date: 2020-06-13T00:36:28.832Z
description: RaspberryPi上でカメラの画像や映像を扱うには`raspivid`コマンドや`raspistill`コマンドを使う。これらを試してみた。
---
RaspberryPi上でカメラの画像や映像を扱うには`raspivid`コマンドや`raspistill`コマンドを使う。これらを試してみた。

`raspistill`は画像を保存するAPI。

[raspistill - Raspberry Pi Documentation](https://www.raspberrypi.org/documentation/usage/camera/raspicam/raspistill.md)

`raspivid`は動画を保存するAPI。

[raspivid - Raspberry Pi Documentation](https://www.raspberrypi.org/documentation/usage/camera/raspicam/raspivid.md)

## 使うWebカメラ

こちらの全天球カメラをRaspberryPiに接続して使う。

[Insta360 Air | Insta360 360度ビデオカメラ | 株式会社アスク](https://www.ask-corp.jp/products/insta360/camera/insta360-air.html)

## 動画保存してみる

下記コマンドで動画保存してみる。

```
raspivid -o vid.h264
```

下記エラーが出た。

```
mmal: Cannot read camera info, keeping the defaults for OV5647
mmal: mmal_vc_component_create: failed to create component 'vc.ril.camera' (1:ENOMEM)
mmal: mmal_component_create_core: could not create component 'vc.ril.camera' (1)
mmal: Failed to create camera component
mmal: main: Failed to create camera component
mmal: Camera is not enabled in this build. Try running "sudo raspi-config" and ensure that "camera" has been enabled
```

カメラデバイスが認識されているか確認するが、認識されていない模様。

``````
vcgencmd get_camera
> supported=0 detected=0
``````

エラーをよく読んでみるとこう書いてあるので`sudo raspi-config`でカメラを有効化してみればよさそう。

> Try running "sudo raspi-config" and ensure that "camera" has been enabled

1. `sudo raspi-config`を実行
1. `5 Interfacing Options`を選択
2. `P1 Camera`を選択
3. `はい`を選択

有効化して再起動して確認してみる。`supported`が`1`になった！

```
vcgencmd get_camera
> supported=1 detected=0
```

カーネルのアップデートをしてみた。

```
sudo rpi-update
sudo reboot 
```

もう一度動画保存をトライ。
```
raspivid -o vid.h264
```

下記エラーが出た。

```
mmal: Cannot read camera info, keeping the defaults for OV5647
mmal: mmal_vc_component_create: failed to create component 'vc.ril.camera' (1:ENOMEM)
mmal: mmal_component_create_core: could not create component 'vc.ril.camera' (1)
mmal: Failed to create camera component
mmal: main: Failed to create camera component
mmal: Camera is not detected. Please check carefully the camera module is installed correctly
```
