---
templateKey: blog-post
title: Storybook v5 ã‚’ TypeScript Ã— React ç’°å¢ƒã«å°å…¥ã™ã‚‹
date: 2019-07-29T13:33:23.040Z
description: >-
  ä»¥å‰ã€GatsbyJS Ã— TypeScriptè£½ã®ã‚µã‚¤ãƒˆã«Storybookã‚’å°å…¥ã™ã‚‹
  ã§ã¯GatsbyJSã®ç’°å¢ƒã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚ä»Šå›ã¯é€šå¸¸ã®TypeScript Ã— Reactç’°å¢ƒã«Storybookã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚
---
ä»¥å‰ã€[GatsbyJS Ã— TypeScriptè£½ã®ã‚µã‚¤ãƒˆã«Storybookã‚’å°å…¥ã™ã‚‹](https://blog.kwst.site/201906081608/) ã§ã¯GatsbyJSã®ç’°å¢ƒã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚ä»Šå›ã¯é€šå¸¸ã®TypeScript Ã— Reactç’°å¢ƒã«Storybookã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## Reactç’°å¢ƒã§Storybookã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

[Storybook for React](https://storybook.js.org/docs/guides/guide-react/) ã®`Automatic setup`ã«æ²¿ã£ã¦ã‚„ã£ã¦ã„ãã¾ã™ã€‚æ‰‹å‹•ã§å…¥ã‚ŒãŸã„å ´åˆã¯`Manual setup`ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```
npx -p @storybook/cli sb init --type react
```

ä»¥ä¸‹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè‡ªå‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

```
"@babel/core": "^7.5.5",
"@storybook/addon-actions": "^5.1.9",
"@storybook/addon-links": "^5.1.9",
"@storybook/addons": "^5.1.9",
"@storybook/react": "^5.1.9",
"@types/storybook__react": "^4.0.2",
"babel-loader": "^8.0.6",
```

ä»¥ä¸‹ã®npm scriptã‚‚è‡ªå‹•ã§æŒ¿å…¥ã•ã‚Œã¾ã™ã€‚

```
"storybook": "start-storybook -p 6006",
"build-storybook": "build-storybook"
```

ä»¥ä¸‹ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚‚è‡ªå‹•ã§ä½œæˆã•ã‚Œã¾ã™ã€‚

```
.storybook/addmins.js
.storybook/config.js
```

`.storybook/addons.js`ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```
import '@storybook/addon-actions/register';
import '@storybook/addon-links/register';
```

`.storybook/config.js`ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```
import { configure } from '@storybook/react';

// automatically import all files ending in *.stories.js
const req = require.context('../stories', true, /\.stories\.js$/);
function loadStories() {
  req.keys().forEach(filename => req(filename));
}

configure(loadStories, module);
```

`stories/index.stories.js`ã‚‚è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```
import React from 'react';

import { storiesOf } from '@storybook/react';
import { action } from '@storybook/addon-actions';
import { linkTo } from '@storybook/addon-links';

import { Button, Welcome } from '@storybook/react/demo';

storiesOf('Welcome', module).add('to Storybook', () => <Welcome showApp={linkTo('Button')} />);

storiesOf('Button', module)
  .add('with text', () => <Button onClick={action('clicked')}>Hello Button</Button>)
  .add('with some emoji', () => (
    <Button onClick={action('clicked')}>
      <span role="img" aria-label="so cool">
        ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯
      </span>
    </Button>
  ));
```

ã“ã‚Œã§Reactç’°å¢ƒã«Storybookã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ãã¾ã—ãŸã€‚æ˜”ã«æ¯”ã¹ã‚‹ã¨å°å…¥ãŒã‚ã¡ã‚ƒãã¡ã‚ƒç°¡å˜ã«ãªã£ã¦ã„ã¾ã™ã€‚

```
npm run storybook
```

èµ·å‹•ã§ãã¾ã—ãŸã€‚

![](/img/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ-2019-07-29-22.23.10.png)

## TypeScriptã«å¯¾å¿œã•ã›ã‚‹

ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚è€ƒã«é€²ã‚ã¾ã—ãŸã€‚`babel-loader`ã‚’ä½¿ã†æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ãŒã€ä»Šå›ã¯`ts-loader`ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

[Setting up TypeScript with babel-loader](https://storybook.js.org/docs/configurations/typescript-config/#setting-up-typescript-with-babel-loader)

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

å‹å®šç¾©ã¨`ts-loader`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚`babel-loader`ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```
npm i -D @types/storybook__react ts-loader babel-loader

```

### TypeScriptã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹

Storybookã§ã¯`.storybook/webpack.config.js`ã‚’è‡ªå‰ã§æº–å‚™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã“ã«TypeScriptã‚’èª­ã¿è¾¼ã‚€è¨­å®šã‚’åŠ ãˆã¾ã™ã€‚

[Custom Webpack Config](https://storybook.js.org/docs/configurations/custom-webpack-config/#full-control-mode--default)

`.storybook/webpack.config.js`ã¯ã“ã®ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚`ts-loader`ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```
module.exports = {
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: "ts-loader"
      }
    ]
  },
  resolve: {
    extensions: [".ts", ".tsx", ".js", ".json"]
  }
};
```

`.storybook/config.js`ã«`.js`ã§ã¯ãªã`.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚

```
...
const req = require.context("../src", true, /\.stories\.tsx$/);
...
```

### react-router-domã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã®storiesã®æ›¸ãæ–¹

react-router-domã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Propsã¯`RouteComponentProps`ã¨ã„ã†å‹ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸ`<Link />`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯`<Router />`ã¨`<Route />`ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚‰ã‚’storiesãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ã‚„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®issueã«å¯¾å¿œç­–ãŒã‚ã‚Šã¾ã—ãŸã€‚

[Component with react router Â· Issue #769 Â· storybookjs/storybook Â· GitHub](https://github.com/storybookjs/storybook/issues/769#issuecomment-386532144)

ã‚ˆãã‚ã‚‹ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`Navigation.tsx`ã€‚react-router-domã®`<Link />`ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ãã®ã¾ã¾storiesã«æ›¸ã„ã¦ã—ã¾ã†ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã„ã¾ã™ã€‚

```
import React from "react";
import { Link, RouteComponentProps } from "react-router-dom";

const LINKS = [
  { to: "/", label: "Home" },
  { to: "/about", label: "About" },
  { to: "/profile", label: "Profile" }
];

const Navigation = (props: RouteComponentProps) => {
  return (
    <nav>
      <ul>
        {LINKS.map(l => {
          return (
            <li key={l.to}>
              <Link to={l.to}>
                {l.label}
              </Link>
            </li>
          );
        })}
      </ul>
    </nav>
  );
};

export default Navigation;
```

`<Router />`ã‚’`addDecoratior`ã§ä½¿ã†ã“ã¨ã§ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã§ãã¾ã™ã€‚

`Navigation.stories.tsx`ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚`RouteComponentProps`ã§ã‚ã‚‹`history`ã¨`location`ã¨`match`ã‚‚ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ã‚„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```
import React from "react";
import { storiesOf } from "@storybook/react";
import Navigation from "./Navigation";
import { Router, Route, match } from "react-router";
import { createMemoryHistory, createLocation } from "history";

const match: match<{}> = {
  isExact: false,
  path: "/",
  url: "/",
  params: {}
};

storiesOf("Navigation", module)
  .addDecorator((story: () => JSX.Element) => (
    <Router history={createMemoryHistory()}>
      <Route path="*" component={() => story()} />
    </Router>
  ))
  .add("with text", () => {
    return (
      <Navigation
        history={createMemoryHistory()}
        location={createLocation("")}
        match={match}
      />
    );
  });
```

ã“ã‚Œã§ã²ã¨ã¾ãšèµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
