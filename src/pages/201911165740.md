---
templateKey: blog-post
title: '『これからのフロントエンドセキュリティ』発表メモ #fec_fukuoka'
date: 2019-11-16T14:56:20.037Z
description: 発表中にとったメモです
---
発表中にとったメモです。

## [『これからのフロントエンドセキュリティ』by 長谷川 陽介氏](https://frontend-conf.fukuoka.jp/sessions#b-7)
- オリジンとは？
  - same origin policy
  - プロトコル + ホスト + ポート
  - http:// + nulab.com + : 8080
  - オリジンが異なればCORSエラー
  - http https でオリジンは異なる
- DOM based xss
  - decodeURIComponent で評価されてしまう
  - cookieを盗む、画面内のクレカ情報を抜き取る
  - 攻撃者の与えた文字列(ソース)をもとにHTMLを操作(シンク)することで発生
  - location.href, location.searchなどを使って混入させる
  - eval, innerHTMLなどを使って実行させる
- 対策はDOM操作関数を使う
  - textContent, setAttributeなどを使う
  - jsなどでリンク生成する時はhttp:// などに限る
  - JSライブラリを最新にする
- mXSS
  - HTMLElement -> String -> HTMLElement という変換をさせるところ
  - `div1.innerHTML = div2.innerHTML`とか文字列でコピーしたらバッククオートとか駆使すればJSが実行できてしまう
  - 対策
    - innerHTMLではなく、cloneNodeなどでHTMLの構造的にコピーする
    - iframeのsandbox属性を使う
    - DOMPurifyなどのmXSSを考慮したライブラリを使う
- open redirect
  - 攻撃者が指定した任意のサイトにリダイレクトをさせられる脆弱性
  - locations.hrefにlocation.hasとかを突っ込んでるところに`/example.com`とか入れたらリダイレクトする
  - 対策
    - URLインターフェースを使う`new URL()`で`origin`が同じであればリダイレクトさせて良い
- x-frame-options
  - クリックジャッキングを防ぐためのレスポンスヘッダー
  - 徐々に規格が縮退方向へ…
  - これからはCSPのframe-ancestorsへ
- CSP(Contents Security Policy)
  - [コンテンツセキュリティポリシー (CSP) - HTTP \| MDN](https://developer.mozilla.org/ja/docs/Web/HTTP/CSP)
  - レスポンスヘッダーを指定することでリソースの読み込み元を制限できる
  - 指定したオリジンからのjsなどは読み込まれなくできる
  - 攻撃されたときにレポートを送ることができる
    - report-uriを指定してpostすることができる
  - frame-ancestors: どこへ埋め込まれるかを指定できる
  - フォームの送信先の制限
  - ブロックすることもできるし、ブロックさせないけどレポートだけ送ることもできる
- CSPでXSSの脅威を大きく低減することができる
  - 許可しているドメイン上に古いJSライブラリとかがあればそれを経由してXSSしたりできる
- CORS(Cross-Origin Resource Sharing)
  - [オリジン間リソース共有 (CORS) - HTTP \| MDN](https://developer.mozilla.org/ja/docs/Web/HTTP/CORS)
  - `Access-control-*`レスポンスヘッダーで細かな制御が可能
- CORP(Cross-Origin Resource Policy )
  - [Cross-Origin Resource Policy (CORP) - HTTP \| MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cross-Origin_Resource_Policy_(CORP))
  - 他のサイトから画像やJSの読み取りを制限できる
  - 潜在的なサイドチャンネル攻撃への対策
- CORB(Cross-Origin Read Blocking )
  - [Cross-Origin Read Blocking (CORB) - Chrome Platform Status](https://www.chromestatus.com/feature/5629709824032768)
  - Content-Typeが合わないときは読み込めないようにする
  - CORPと同様潜在的なサイドチャンネル攻撃への対策
  - [Cross-Origin Read Blocking (CORB) とは - ASnoKaze blog](https://asnokaze.hatenablog.com/entry/2018/04/10/205717)
- CSP〜CORB
  - 攻撃者の作成した罠サイト経由でデータを読み込まれることへの防御機構が充実
- Same Site Cookie
  - Cookieの送信を同一サイト内に限定する仕組み
  - strict
    - クロスサイトでのCookieを一切送信しなくなる
  - lax
    - リンククリックでのページ遷移(top-level navigation)などを除き、Cookieを送信しない
  - 罠ページからのiframeやscript, form postなどでCookieが送信されなくなる
  - samesite=laxがデフォルトになる
- 今日紹介できなかったもの
  - SRI, Fetch, metadata, XS-Search, XS-Leaks
